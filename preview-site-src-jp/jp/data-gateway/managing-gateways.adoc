= ゲートウェイの管理
:keywords: データゲートウェイ, salesforce, sap, oracle
:page-component-name: data-gateway

// Support notification from PM.
include::partial$support-warning.adoc[]

== ログイン

データゲートウェイを​xref:installing-anypoint-data-gateway.adoc[インストールした]​後、​*[MuleSoft]*​ タブに移動し、Anypoint データゲートウェイデザイナにアクセスします。

image::ms-tab-1_2.png[データゲートウェイのメイン画面]

== ユーザロールと権限

データゲートウェイは Anypoint Platform の一部であるため、Anypoint Platform で定義されたビジネスグループと環境をサポートしています。 +
適切なデータゲートウェイのエンタイトルメントを持つシステム管理者プロファイルで、Anypoint Platform 内の [Organization Administration (組織のシステム管理者)] ページからデータゲートウェイの権限を設定できます。

データゲートウェイの権限は、​_[Permissions (権限)]_​ タブ内の独自の表示ラベルで管理されます。

データゲートウェイの権限を割り当てる方法についての詳細は、​xref:access-management::managing-permissions.adoc#Data-Gateway-Permissions[「アカウントのロールと権限の管理」]​の手順を参照してください。

ロールのリストとデータゲートウェイで各ロールが付与する権限を次に示します。
[%header,cols="40,60"]
|===
|定義されたロール |データゲートウェイでの権限
|Data Gateway Admin (データゲートウェイ管理者) |すべて (制限なし)
|Data Gateway Viewer (データゲートウェイ閲覧者) a|
* ゲートウェイの表示
* 接続の表示
* 通知の表示
* MuleSoft への問い合わせ

ユーザはゲートウェイや接続を作成または編集できない。
|ロールが未定義| データゲートウェイへのアクセス権がない。
|===
[NOTE]
データゲートウェイの権限が定義されていない場合でも、Anypoint Platform の​*組織のオーナー*​ロールがあれば、データゲートウェイにアクセスすることができます。

== Anypoint データゲートウェイデザイナの概要

Salesforce アカウントから Anypoint データゲートウェイにログインすると、[Anypoint Data Gateway Designer (Anypoint データゲートウェイデザイナ)] 画面が表示されます。この画面では、次のようなアクションを実行できます。

* ゲートウェイの表示、追加、変更
* 接続と VPC の設定
* ゲートウェイログの表示

下の画像は、2 つの既存のゲートウェイを表示する画面です。画像の下にある番号を参照してください。

image::gateway-list-numbered-1_3.png[ゲートウェイのリスト]

[%header%autowidth.spread]
|===
|番号 |説明
|1 |ゲートウェイのリスト。この場合は、​`MyGateway`​、​`Test4`​、​`TestGateway`​ という 3 つのゲートウェイを表示しています。
|2 a|
左側のメニューペイン。次の操作を実行できます。

* ゲートウェイの表示と編集 (上記の画面を使用)
* 設定の作成または設定
* Salesforce 設定にアクセス
* オンラインドキュメントにアクセス
* VPC の設定
* サブスクリプションのアップグレード (Salesforce のみ)

|3 |環境セレクタドロップダウンメニュー。Anypoint Platform で設定された環境の中から作業を行う環境 (本番、開発など) を選択できます。(環境、ユーザロール、権限の詳細は上記参照)。
|4 |*[Create Gateway (ゲートウェイを作成)]*​ ボタン。クリックして新しいゲートウェイを作成します (詳細は、​xref:creating-and-configuring-a-gateway.adoc[「ゲートウェイの作成と設定」]​を参照)。
|5 |[Search gateways (ゲートウェイを検索)] 入力ボックス。文字列を入力すると、名前にその文字列を含むゲートウェイのみが表示されます。
|6 |[Support (サポート)] ボタン。クリックして MuleSoft サポートに問い合わせます (トライアルアカウントを使用している場合は問い合わせフォーム)。
|7 |[Organization configuration (組織設定)] ボタン。クリックして Anypoint Platform 内から組織を設定します。ログインが必要な場合があります。
|8 |[Organization/Business Group (組織/ビジネスグループ)] ドロップダウンメニュー。クリックして使用可能な組織やビジネスグループの中から選択します。選択すると、その組織またはビジネスグループ用のゲートウェイデザイナにアクセスすることができます。

image::suborg-menu-1_2.png[suborg_menu-1.2]

|9 |[Data Gateway (データゲートウェイ)] メニュー。Anypoint Platform プロファイルを表示および編集、またはデータゲートウェイからサインアウトできます。
|10 a|
通知インジケータ。クリックすると最近の通知が表示され、次に示すように、必要に応じて通知に関連するタスクを実行できます。

image::notifications-1_2.png[notifications-1.2]

|11 |ゲートウェイの状況インジケータ。ここに表示されたすべてのゲートウェイは​*停止中*​で、塗りつぶされていない丸で表されます。緑の丸は​*開始済み*​を意味します。
|12 |ゲートウェイの ​*[Edit (編集)]*​ メニュー。クリックしてゲートウェイを編集または破棄します。
|===

== 左側のメニュー

左側のメニューで、このセクションで説明するタスクを実行できます。

=== Gateways (ゲートウェイ)

「​<<Anypoint Data Gateway Designer の概要>>​」で示した画面を表示します。ここで、ゲートウェイを作成/編集または操作することができます。

=== Connections (接続)

新しい接続を作成、または既存の接続を編集できます。

image::connections-1_2.png[connections-1.2]

新しい接続を作成する場合は、​*[Create Connection (接続を作成)]*​ をクリックします。

既存の接続を編集する場合は、接続名をクリックします。​*[Update Connection (接続の更新)]*​ 設定ダイアログが表示され、目的の接続のパラメータを更新できます。

既存の接続を削除する場合は、接続名の上にマウスポインタを置き、左に表示される削除アイコン image:remove-icon-1_2.png[remove_icon-1.2] をクリックします。

=== Documentation (ドキュメント)

クリックすると、​xref:index.adoc[オンラインドキュメントのメインページ]​に移動します。

=== VPC Setup (VPC セットアップ)

使用可能な Virtual Private Cloud (VPC) 種別の中から選択し、VPC パラメータを定義できます。

image::vpc-setup.png[vpc.setup]

=== Upgrade (アップグレード)

クリックして https://www.mulesoft.com/platform/data-gateway#pricing[製品メインページ]に移動し、サブスクリプションを変更できます。


== ゲートウェイの操作

[TIP]
このセクションでは、既存のゲートウェイを操作する方法について説明します。新しいゲートウェイの作成についての詳細は、​xref:creating-and-configuring-a-gateway.adoc[「ゲートウェイの作成と設定」]​を参照してください。

データゲートウェイのデータベースでサポートされるデータ型は次のとおりです。

* VARCHAR
* VARCHAR2
* CHAR
* TINYTEXT
* TEXT
* BLOBL
* BLOB
* MEDIUMTEXT
* MEDIUMBLOB
* LONGTEXT
* LONGBLOB
* ENUM
* SET
* CHARACTER
* NCHAR
* NVARCHAR
* NTEXT
* BIT
* BINARY
* VARBINARY
* IMAGE
* SQL_VARIANT​
* UNIQUEIDENTIFIER
* XML
* CURSOR
* TABLE
* CLOB
* VARGRAPHIC
* DBCLOB
* INTEGER
* INT
* TINYINT
* SMALLINT
* MEDIUMINT
* BIGINT
* FLOAT
* DOUBLE
* DECIMAL
* NUMBER
* NUMERIC
* SMALLMONEY
* MONEY
* REAL
* DECFLOAT
* DATE
* DATETIME
* TIME
* YEAR
* TIMESTAMP
* DATETIME2
* SMALLDATETIME
* DATETIMEOFFSET
* BOOLEAN
* INTERVAL

=== ゲートウェイの状況の変更

既存のゲートウェイの状況を変更する手順は、次のとおりです。

. 左側のグローバルメニューで ​*[Gateways (ゲートウェイ)]*​ をクリックして、ゲートウェイデザイナのゲートウェイリストに移動します。
. ゲートウェイリストで、変更するゲートウェイを見つけ、右にある ​*[Edit (編集)]*​ メニューをクリックします。
+
image::modifying-gw-status-1_2.png[modifying_gw_status-1.2]
+

. 選択可能なオプション ​*[Publish (パブリッシュ)]*​、​*[Start (開始)]*​、​*[Delete (削除)]*​、​*[Settings (設定)]*​ の中から選択します。この最後のオプションを選択すると、以下で説明する Salesforce の設定画面に移動します。

=== ゲートウェイ設定の変更

ゲートウェイの設定 (名前や URL など) を変更するには、ゲートウェイの ​*[Edit (編集)]*​ メニュー (上記参照) をクリックして、​*[Settings (設定)]*​ を選択します。または、ゲートウェイリストでゲートウェイをクリックし、左側のメニューの ​*[Settings (設定)]*​ をクリックします。ゲートウェイデザイナに次のようなゲートウェイの ​*[Settings (設定)]*​ 画面が表示されます。

image::data-gateway-settings-menu.png[gw_settings-1.2]

完了したら、​*[Save (保存)]*​ をクリックします。

==== ポリシー

必要に応じて、​xref:api-manager::rate-limiting-and-throttling.adoc[調整]​ポリシーをゲートウェイに適用できます。

==== Salesforce

ゲートウェイはすべて一意の外部データソースを通して Salesforce に公開され、Lighting Connect ライセンスが 1 つ消費されます。

特定のゲートウェイの ​*[Edit (編集)]*​ ボタンをクリックして ​*[Publish (パブリッシュ)]*​ を選択するか、左ナビゲーションバーの Salesforce 項目をクリックして、Salesforce 設定メニューにアクセスできます。

image::publish-1_2.png[publish-1.2]

データゲートウェイをパブリッシュする手順は、次のとおりです。

. パブリッシュするデータゲートウェイを選択します。
. *[保存]*​ をクリックします。

[NOTE]
====
以前のバージョンのデータゲートウェイでは、各ゲートウェイは Salesforce Connect ライセンスにマップされました。現在は、すべてのゲートウェイが 1 つの外部データソースを通してチャネルされ、この画面に表示される Odata API を通して公開されるようになりました。

*[Edit (編集)]*​ -> ​*[Settings (設定)]*​ をクリックして個々のゲートウェイの設定を入力すると、そのゲートウェイを公開するエンドポイントの異なる URL が表示されます。このエンドポイントは、Salesforce と同期するためには使用されませんが、他の OData コンシューマと接続するために役立ちます。
====



=== オブジェクトの操作

ゲートウェイのオブジェクトを追加、変更、削除したり、ゲートウェイ間でオブジェクトを​<<コピー,コピー>>​したりすることもできます。

オブジェクトに対する操作の実行方法

ゲートウェイのオブジェクトを追加、変更、削除する方法は、次のとおりです。

* ゲートウェイのリスト内のゲートウェイをクリックする。
* ゲートウェイの ​*[Edit (編集)]*​ メニュー (上記参照) をクリックし、​*[Create Object (オブジェクトを作成)]*​ を選択する。
* または ​*[Settings (設定)]*​ をクリックし、左側のメニューで ​*[Objects (オブジェクト)]*​ をクリックする。

[Objects (オブジェクト)] 画面に、ゲートウェイのオブジェクトが表示されます。下の画像のゲートウェイ ​`MySQL thru AP`​ には、​`gateways`​ と ​`users`​ という 2 つのオブジェクトが含まれています。

image::add-object-1-1_2.png[add.object-1-1.2]

==== 新規オブジェクトの作成

ゲートウェイに新しいオブジェクトを追加するには、​*[Create Object (オブジェクトを作成)]*​ をクリックします。

データゲートウェイに ​*[New Object (新規オブジェクト)]*​ 画面が表示されます。

image::add-object-2-1_2.png[add.object-2-1.2]

オブジェクトを作成するには、次を行う必要があります。

. オブジェクトを配置するテーブルを選択します。
. オブジェクトの名前を指定します。
. オブジェクトの説明を入力します (省略可能)。
. オブジェクトの項目を選択します。

テーブルを選択するには、使用可能なテーブルリストを検索するか、検索ボックスにテーブルの完全な名前または一部を入力します。入力する文字列は、テーブルのどの部分でもよく、大文字と小文字が区別されます。

image::add-object-3-1_2.png[add.object-3-1.2]

テーブルを選択すると、​*[Create an External Object (外部オブジェクトを作成)]*​ 画面の項目セレクタにテーブルの項目が入力されます。検索ボックスを使用して目的の項目を検索します。次に示すように、個々の項目をクリックして選択します。すべての項目を選択する場合は、​*[Name (名前)]*​ 列の横にある空のチェックボックスをクリックします。

image::add-object-4-1_2.png[add.object-4-1.2]

主キーが割り当てられた項目 (上のスクリーンショットの ​`id`​) は、アイコンでマークされます。テーブルに主キーがない場合は、目的の項目の上にマウスポインタを置き、キー名の横に表示される鍵アイコンをクリックして手動で割り当てることができます。

[NOTE]
SAP システムから取得されるテーブルでは、一部の項目に ​*[Description (説明)]*​ 列が表示される場合があります。

[TIP]
選択した項目のみがテーブルに表示されるように切り替えるには、検索ボックスの左に表示される眼のアイコン image:eye-icon-1_2.png[eye_icon-1.2] をクリックします。

テーブル、オブジェクト名、項目を選択した後、画面右下にある ​*[Create Object (オブジェクトを作成)]*​ をクリックします。

==== 既存のオブジェクトの変更

ゲートウェイのオブジェクトを変更するには、変更するオブジェクトをクリックします。データゲートウェイにオブジェクトのプロパティ画面が表示され、オブジェクトを変更できます。

これは、「​<<新規オブジェクトの作成>>​」で使用したものと同じ画面です。下の画像は、ゲートウェイ ​`MySQL thru AP`​ のオブジェクト ​`users`​ の設定ウィンドウを示しています。

image::modif-object-1_2.png[オブジェクトの変更]

[[copy]]
==== ゲートウェイ間でのオブジェクトのコピー

データゲートウェイでは、ゲートウェイ間でオブジェクトをコピーすることができます。この機能は、開発環境と本番環境など、類似の状態で維持する複数の環境を使用する場合に特に便利です。

データゲートウェイでは、オブジェクトをコピーするときに、コピー先ゲートウェイに作成される新規オブジェクトが有効であることを確認するためのチェックが実行されます。コピー先ゲートウェイにオブジェクトが存在しない場合は、エラーが発生してもコピーされます。コピーしたオブジェクトを有効にするには、エラーのある各オブジェクトにアクセスして修正する必要があります。一方、オブジェクトがコピー先ゲートウェイにすでに存在している場合は、オブジェクトをコピーすると対象オブジェクトにエラーが発生するので、データゲートウェイはコピー操作の実行を拒否します。たとえば、コピー元オブジェクトが、コピー先ゲートウェイに存在しないデータベーステーブルに属している場合、または既存の項目間に不一致がある場合、データゲートウェイはエラーを報告し、オブジェクトをコピーしません。

オブジェクトをコピーする手順は、次のとおりです。

. _コピー先_​ゲートウェイ (オブジェクトのコピー先のゲートウェイ) に移動し、ゲートウェイのオブジェクトのリストにアクセスします。(たとえば、ゲートウェイのリストで目的のゲートウェイをクリックし、左側のメニューで ​*[Objects (オブジェクト)]*​ をクリックします)。
. *[Create Object (オブジェクトを作成)]*​ の横の下矢印をクリックし、​*[Copy Objects From... (オブジェクトを次からコピー...)]*​ を選択します。

image::copy-objs-menu.png[[Copy Objects (オブジェクトをコピー)] メニュー]

データゲートウェイに ​*[Copy Objects (オブジェクトをコピー)]*​ 画面が表示されます。この画面で、​_コピー元_​ゲートウェイとオブジェクトを選択できます。

image::copy-objs-screen.png[[Copy Objects (オブジェクトをコピー)] 画面]

[start=3]
. 1 つ目のドロップダウンメニューから、コピー元環境 (コピー元ゲートウェイが属している環境) を選択します。コピー元環境を選択すると、コピー元ゲートウェイドロップダウンメニュー (画面の 2 つ目のドロップダウンメニュー) にその環境に有効なゲートウェイのリストが読み込まれます。有効なゲートウェイがない場合はメッセージが表示されます。
. 2 つ目のドロップダウンメニューからコピー元ゲートウェイを選択します。
. コピー元ゲートウェイを選択すると、左側のオブジェクトのリストに、コピー元ゲートウェイで使用可能なオブジェクトが入力されます。各オブジェクトの項目数が右側に表示されます。オブジェクトの上にマウスポインタを置くと、そのオブジェクトの項目のリストを表示できます。コピーするオブジェクトを選択し、​*[Copy Objects (オブジェクトをコピー)]*​ をクリックします。

コピーするオブジェクトがコピー先ゲートウェイにすでに存在している場合、データゲートウェイから、そのオブジェクトを上書きするか、オブジェクトのコピーをスキップするよう要求されます。コピー操作がエラーなく完了すると、オブジェクトのリストが再び表示されます。

コピー操作でエラーが発生すると、オブジェクトはコピー​_されず_​、代わりにエラーメッセージが表示されます。

image::copy-error-msg.png[オブジェクトコピーのエラーメッセージ]

エラーが発生した場合は、​_[Logs (ログ)]_​ タブでトリガを追跡し、エラーごとに絞り込むことができます。

image::copy-error-msg2.png[オブジェクトコピーのエラーメッセージ]


== ゲートウェイログの表示

ゲートウェイのログを表示するには、ゲートウェイのリストでゲートウェイをクリックし、左側のメニューから ​*[Logs (ログ)]*​ を選択します。

下の画像にあるように、ゲートウェイのログはブラウザウィンドウのスクロール可能なペインに表示されます。このログビューアを使用して次の操作が可能です。

* ログの上にある検索ボックスを使用したログエントリの検索
* 最後の 100 件 (デフォルト)、200 件、または 500 件のログエントリの表示
* ログのすべての優先度 (デフォルト) のエントリ、または ​`INFO`​、​`ERROR`​、​`WARN`​ などの特定の優先度のみのエントリの表示。
* ローカルマシンにログをテキストファイルとしてダウンロード

ログをダウンロードするには、右上のダウンロードボタン image:download-icon-1_2.png[download_icon-1.2] を使用します。

image::log.png[]
